{% extends 'courses/base.html' %}
{% load static %}

{% block title %}Dashboard - SkillUp{% endblock %}

{% block header_title %}My Dashboard{% endblock %}

{% block content %}
<div class="relative overflow-hidden mb-8">
    <div class="primary-light-bg rounded-lg p-6 pr-36">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome back, {{ request.user.get_full_name|default:request.user.username }}!</h2>
        <p class="text-gray-600 mb-4">Continue your learning journey with SkillUp.</p>
        <a href="{% url 'my_courses' %}" class="inline-block primary-bg text-white px-4 py-2 rounded-md font-medium hover:bg-green-600 transition-colors">
            Continue Learning
        </a>
    </div>
    <svg class="curved-shape" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="#e6f7e6" d="M36.5,-57.2C45.9,-47.3,50.8,-33.3,57.7,-18.5C64.5,-3.8,73.3,11.7,71.6,25.9C69.9,40.1,57.8,53,43.5,62.3C29.2,71.6,12.8,77.4,-1.6,79.5C-16,81.5,-28.3,80,-40.7,73.3C-53.1,66.7,-65.4,55,-72,40.7C-78.6,26.4,-79.4,9.7,-77.6,-6.6C-75.8,-22.9,-71.3,-38.7,-61,-50.7C-50.7,-62.8,-34.6,-71,-19.5,-72C-4.4,-73,10.7,-66.8,23.9,-61.3C37,-55.8,48.2,-51,56.6,-42.6C65,-34.3,70.4,-22.4,74,-9.7C77.6,3,79.5,16.5,77.5,30.4C75.6,44.3,69.9,58.6,59.3,69.1C48.7,79.6,33.3,86.4,17.8,87.3C2.3,88.2,-13.2,83.2,-27.4,76.4C-41.6,69.6,-54.5,61,-67.2,49.3C-79.8,37.5,-92.2,22.7,-95.9,5.9C-99.6,-10.9,-94.5,-29.7,-83.6,-43.6C-72.7,-57.6,-55.9,-66.6,-39.8,-72.7C-23.7,-78.8,-8.3,-82.1,4.5,-78.6C17.2,-75.1,30.4,-64.9,43.8,-55.6C57.2,-46.4,70.9,-38.2,73.5,-27.1C76.2,-16,67.9,-2.1,63.8,12.5C59.8,27.1,60,42.4,53.4,54.1C46.7,65.8,33.3,73.9,18.7,76.8C4,79.7,-11.8,77.4,-25.9,72.2C-40,67,-52.3,58.8,-62.9,47.8C-73.4,36.8,-82.1,22.9,-85.5,7.3C-88.9,-8.3,-87,-25.6,-79.2,-39.7C-71.4,-53.8,-57.6,-64.7,-42.6,-70.7C-27.6,-76.8,-11.5,-78,-0.5,-77.3C10.5,-76.6,25.9,-74,36.5,-65.7C47.1,-57.4,52.8,-43.3,60.5,-29.4C68.2,-15.5,77.9,-1.7,78.7,12.5C79.6,26.7,71.6,41.3,61.3,53.8C50.9,66.3,38.3,76.6,23.3,82.3C8.3,88,-9.2,89,-24.4,84.3C-39.6,79.6,-52.5,69.3,-62.4,57.1C-72.3,44.9,-79.2,30.8,-81.5,15.8C-83.9,0.8,-81.7,-15.1,-75.3,-28.6C-68.8,-42.1,-58.1,-53.2,-45.3,-59.1C-32.5,-65,-17.7,-65.6,-2.5,-62.4C12.7,-59.2,28.5,-52.2,36.5,-57.2Z" transform="translate(100 120)" />
    </svg>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Learning Progress -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Your Learning Progress</h3>
        <div class="space-y-4">
            {% for enrollment in in_progress_enrollments %}
            <div>
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm font-medium text-gray-700">{{ enrollment.course.title }}</span>
                    <span class="text-xs text-gray-500">{{ enrollment.progress }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="primary-bg h-2.5 rounded-full" style="width: {{ enrollment.progress }}%"></div>
                </div>
            </div>
            {% empty %}
            <p class="text-gray-500 text-sm">You haven't started any courses yet.</p>
            <a href="#" class="text-sm primary hover:underline">Explore courses</a>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Achievements -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Achievements</h3>
        <div class="space-y-4">
            {% for certificate in recent_certificates %}
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <span class="flex items-center justify-center h-10 w-10 rounded-full primary-light-bg">
                        <svg class="w-6 h-6 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </span>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">
                        Completed "{{ certificate.course.title }}"
                    </p>
                    <p class="text-xs text-gray-500">
                        {{ certificate.created_at|date:"F j, Y" }}
                    </p>
                </div>
                <div class="ml-auto">
                    <a href="{{ certificate.pdf.url }}" target="_blank" class="text-xs primary hover:underline">
                        View Certificate
                    </a>
                </div>
            </div>
            {% empty %}
            <p class="text-gray-500 text-sm">You haven't earned any certificates yet.</p>
            <p class="text-sm">Complete a course to earn your first certificate!</p>
            {% endfor %}
        </div>
    </div>
</div>

<div class="mb-8">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">Courses In Progress</h3>
        <a href="{% url 'my_courses' %}" class="text-sm primary hover:underline">View all</a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for enrollment in in_progress_enrollments|slice:":3" %}
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="h-40 bg-gray-200 relative">
                {% if enrollment.course.cover_image %}
                <img src="{{ enrollment.course.cover_image.url }}" alt="{{ enrollment.course.title }}" class="w-full h-full object-cover">
                {% else %}
                <div class="flex items-center justify-center h-full primary-light-bg">
                    <svg class="w-12 h-12 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                {% endif %}

                <div class="absolute bottom-0 left-0 right-0 bg-gray-900 bg-opacity-60 py-2 px-3">
                    <div class="flex justify-between text-white text-xs">
                        <span>Progress: {{ enrollment.progress }}%</span>
                        <span>{{ enrollment.lessons_completed }} / {{ enrollment.course.lesson_count }} lessons</span>
                    </div>
                </div>
            </div>
            <div class="p-4">
                <h4 class="font-semibold text-gray-800 mb-2">{{ enrollment.course.title }}</h4>
                <p class="text-sm text-gray-600 mb-3 line-clamp-2">{{ enrollment.course.description }}</p>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div class="primary-bg h-2 rounded-full" style="width: {{ enrollment.progress }}%"></div>
                </div>
                <a href="{% url 'course_detail' enrollment.course.id %}" class="block text-center primary-bg text-white py-2 rounded-md hover:bg-green-600 transition-colors">
                    Continue Learning
                </a>
            </div>
        </div>
        {% empty %}
        <div class="col-span-3">
            <div class="bg-white rounded-lg shadow-sm p-6 text-center">
                <svg class="w-16 h-16 primary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
                <h4 class="text-lg font-semibold text-gray-800 mb-2">You haven't enrolled in any courses yet</h4>
                <p class="text-gray-600 mb-4">Explore our course catalog and start your learning journey today!</p>
                <a href="#" class="inline-block primary-bg text-white px-6 py-2 rounded-md font-medium hover:bg-green-600 transition-colors">
                    Browse Courses
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Stats Card 1 -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
            <div class="flex-shrink-0 p-3 rounded-full primary-light-bg">
                <svg class="w-6 h-6 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
            </div>
            <div class="ml-4">
                <h4 class="text-sm font-medium text-gray-500">Enrolled Courses</h4>
                <p class="text-2xl font-semibold text-gray-800">{{ total_enrollments }}</p>
            </div>
        </div>
    </div>
    
    <!-- Stats Card 2 -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
            <div class="flex-shrink-0 p-3 rounded-full primary-light-bg">
                <svg class="w-6 h-6 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="ml-4">
                <h4 class="text-sm font-medium text-gray-500">Completed Courses</h4>
                <p class="text-2xl font-semibold text-gray-800">{{ completed_courses }}</p>
            </div>
        </div>
    </div>
    
    <!-- Stats Card 3 -->
    <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
            <div class="flex-shrink-0 p-3 rounded-full primary-light-bg">
                <svg class="w-6 h-6 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="ml-4">
                <h4 class="text-sm font-medium text-gray-500">Learning Hours</h4>
                <p class="text-2xl font-semibold text-gray-800">{{ total_hours }}</p>
            </div>
        </div>
    </div>
</div>

<div class="mb-8">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">Recommended Courses</h3>
        <a href="#" class="text-sm primary hover:underline">View all</a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for course in recommended_courses %}
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="h-36 bg-gray-200 relative">
                {% if course.cover_image %}
                <img src="{{ course.cover_image.url }}" alt="{{ course.title }}" class="w-full h-full object-cover">
                {% else %}
                <div class="flex items-center justify-center h-full primary-light-bg">
                    <svg class="w-10 h-10 primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                {% endif %}
            </div>
            <div class="p-4">
                <h4 class="font-semibold text-gray-800 mb-2 text-sm line-clamp-1">{{ course.title }}</h4>
                <p class="text-xs text-gray-600 mb-3 line-clamp-2">{{ course.description }}</p>
                <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-500">{{ course.lesson_count }} lessons</span>
                    <span class="text-xs text-gray-500">{{ course.duration }} hours</span>
                </div>
                <a href="{% url 'course_detail' course.id %}" class="block text-center mt-3 primary-bg text-white py-1.5 rounded text-sm hover:bg-green-600 transition-colors">
                    View Course
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}